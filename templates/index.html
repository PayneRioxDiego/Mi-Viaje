<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úàÔ∏è Planeador de Viajes IA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .card-viaje { transition: transform 0.2s; border: none; shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .card-viaje:hover { transform: translateY(-5px); }
        .score-badge { font-size: 1.2em; font-weight: bold; }
        .spinner-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 1000; justify-content: center; align-items: center; flex-direction: column; }
    </style>
</head>
<body>

<div class="container py-4">
    <h1 class="text-center mb-4">‚úàÔ∏è Nuestro Viaje</h1>
    
    <div class="card p-4 shadow-sm mb-5">
        <div class="input-group mb-3">
            <input type="text" id="urlInput" class="form-control form-control-lg" placeholder="Pega aqu√≠ el link de TikTok...">
            <button class="btn btn-primary btn-lg" type="button" onclick="analizarVideo()">‚ú® Analizar</button>
        </div>
        <small class="text-muted">Pega un link y la IA extraer√° los datos.</small>
    </div>

    <div id="resultados" class="row">
        </div>
</div>

<div id="loading" class="spinner-overlay">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status"></div>
    <h4 class="mt-3">La IA est√° viendo el video...</h4>
    <p>Esto puede tomar unos segundos.</p>
</div>

<script>
    async function analizarVideo() {
        const url = document.getElementById('urlInput').value;
        if (!url) return alert("¬°Por favor pega una URL!");

        // Mostrar carga
        document.getElementById('loading').style.display = 'flex';

        try {
            // Llamada a TU Backend (Flask)
            const response = await fetch('/analizar', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url: url })
            });

            const data = await response.json();

            if (data.error) {
                alert("Error: " + data.error);
            } else {
                agregarTarjeta(data);
            }

        } catch (error) {
            console.error('Error:', error);
            alert("Ocurri√≥ un error al conectar con el servidor.");
        } finally {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('urlInput').value = ''; // Limpiar input
        }
    }

    function agregarTarjeta(data) {
        const contenedor = document.getElementById('resultados');
        
        // Determinar color seg√∫n categor√≠a (L√≥gica visual)
        let colorBorde = "border-primary";
        let icono = "üìç";
        if (data.categoria === "Comida") { colorBorde = "border-warning"; icono = "üçú"; }
        if (data.categoria === "Actividad") { colorBorde = "border-success"; icono = "üéüÔ∏è"; }

        const html = `
            <div class="col-md-4">
                <div class="card card-viaje ${colorBorde} border-3 h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <h5 class="card-title fw-bold">${icono} ${data.nombre || 'Lugar Desconocido'}</h5>
                            <span class="badge bg-dark">${data.puntuacion || '?'} ‚≠ê</span>
                        </div>
                        <h6 class="card-subtitle mb-2 text-muted">üìç ${data.ubicacion || 'Ubicaci√≥n no detectada'}</h6>
                        <p class="card-text mt-3">${data.resumen || 'Sin resumen disponible.'}</p>
                        
                        <div class="mt-3">
                            <span class="badge bg-light text-dark border">${data.precio || 'Precio?'}</span>
                            <span class="badge bg-info text-dark">${data.categoria}</span>
                        </div>
                        
                        ${data.es_trampa ? '<div class="alert alert-danger mt-2 p-1 text-center small">‚ö†Ô∏è Posible Trampa Tur√≠stica</div>' : ''}
                    </div>
                    <div class="card-footer bg-white border-0">
                        <small class="text-muted d-block text-end">Veredicto IA: ${data.veredicto || '...'}</small>
                    </div>
                </div>
            </div>
        `;
        
        // Agregar al principio de la lista
        contenedor.insertAdjacentHTML('afterbegin', html);
    }
</script>

</body>
</html>
